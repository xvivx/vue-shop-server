## 项目介绍
开发层面使用 `Express` 做为后端框架，部署层面使用阿里OSS托管前端静态资源、阿里云函数计算部署后端服务，`credentials.js` 包含了阿里云账号和密码，恕不能上传。其结构如下:
```js
// oss配置
{
  timeout: 5 * 1000,
  region: `OSS所在地域`,
  accessKeyId: `你的accessKeyId`,
  accessKeySecret: `你的accessKeySecret`,
  bucket: `function-shop-static`,
  endpoint: `你的OSS的endpoint`,
  internal: isPrd
}

// 函数计算配置
{
  accessKeyID: `你的accessKeyID`,
  accessKeySecret: `你的accessKeySecret`,
  region: '函数所在地域',
  timeout: 2 * 60 * 1000
}

```
本项目没有使用数据库，中间有尝试使用阿里云的表格存储，但是不能做到0成本使用，对我这个纯粹学习来用的项目来说过于昂贵。也考虑过使用`mongoDB`，一样也是收费服务。暂时决定使用文件存储项目数据，存储数据的文件部署在OSS上。考虑到频繁读写文件会有损性能，于是在OSS上进行了一次封装，拦截读写操作，内存缓存数据，惰性读写。对于读，第一次读后缓存数据。对于写，延迟写入，数据暂存内存，写入前会去读取最新数据进行merge更新，同时也更新读取操作中的数据。可访问线上地址进行体验。[线上传送门](http://xvivx.online)。


## 功能介绍

1. 封装OSS的SDK，便于读写操作
2. 全局异常处理
3. 缓存读取、延迟写入，极大提高接口响应速度，`merge` 写入、失败重试，最大化保证数据完整
4. 中间件封装，登录验证、权限验证
5. serverless部署，使用阿里云函数计算，目前网站可0成本运行
6. 封装阿里云函数计算sdk，可命令行发布
7. gulp自动化（清理，打包，发布）
8. 令牌实时刷新，活跃用户自动延时令牌过期

OSS承载前端静态资源、后端数据文件、户上传的文件（用户头像、轮播、商品图片等），函数计算托管服务端代码。

## 痛点

前端调用关联接口的场景不少，比如登录后要查询用户信息，查询购物车信息，可能还要查询收藏夹信息，后面可能会查询更多的信息，无法预测，现在接口是独立的，查询用户信息需要一个接口，查询购物车需要一个接口。。。，能否使用一个接口轻松获取所需全部数据。另外一个场景，商品展示的时候不需要全部字段返回（比如商品创建时间、更新时间等），在服务端一个一个delete又太累，可维护性也会变差，所以引入 `graphql` 解决这些问题。

## TODO
接入 `graphql`